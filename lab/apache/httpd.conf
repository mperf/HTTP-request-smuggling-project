ServerRoot "/usr/local/apache2"
Listen 80

#LoadModule mpm_event_module modules/mod_mpm_event.so
#LoadModule authz_core_module modules/mod_authz_core.so
# LoadModule dir_module modules/mod_dir.so
# LoadModule mime_module modules/mod_mime.so
# LoadModule proxy_module modules/mod_proxy.so
# LoadModule proxy_http_module modules/mod_proxy_http.so
# LoadModule rewrite_module modules/mod_rewrite.so
# #LoadModule unixd_module modules/mod_unixd.so
# LoadModule auth_basic_module modules/mod_auth_basic.so
# #LoadModule authn_core_module modules/mod_authn_core.so
# LoadModule authn_file_module modules/mod_authn_file.so
# LoadModule authz_user_module modules/mod_authz_user.so
# LoadModule authz_groupfile_module modules/mod_authz_groupfile.so
# # LoadModule env_module modules/mod_env.so
# # LoadModule headers_module modules/mod_headers.so
# LoadModule reqtimeout_module modules/mod_reqtimeout.so

User daemon
Group daemon

<IfModule dir_module>
    DirectoryIndex index.html
</IfModule>

<Files ".ht*">
    Require all denied
</Files>

ErrorLog /proc/self/fd/2
LogLevel warn

# Proxy configuration for HTTP request smuggling lab



# This configuration is vulnerable to CL.TE smuggling
# Apache prioritizes Content-Length and strips Transfer-Encoding

# <VirtualHost *:80>
#     DocumentRoot "/usr/local/apache2/htdocs"
#     SetEnv force-no-te 1
#     # Admin access control - require admin group
#     <Location "/admin">
#         AuthType Basic
#         AuthName "Admin Access Required"
#         AuthUserFile /usr/local/apache2/conf/.htpasswd
#         AuthGroupFile /usr/local/apache2/conf/.htgroups
#         Require group admin
#     </Location>

#     RequestReadTimeout header=20-40,minrate=500 body=20,minrate=500

    
#     # Proxy all requests to backend
#     ProxyPass / http://backend:3000/
#     ProxyPassReverse / http://backend:3000/
    
#     # Key: Apache strips Transfer-Encoding headers by default
#     # This creates the CL.TE vulnerability
# </VirtualHost>

<VirtualHost *:80>
    ServerName vulnerable-lab.local

 

    # Proxy all requests to backend, do not canonicalize URL
    ProxyPass / http://backend:3000/ nocanon
    ProxyPassReverse / http://backend:3000/ nocanon

    <Location "/admin">
        AuthType Basic
        AuthName "Admin Access Required"
        AuthUserFile /usr/local/apache2/conf/.htpasswd
        AuthGroupFile /usr/local/apache2/conf/.htgroups
        Require group admin
    </Location>

    ErrorLog /proc/self/fd/2
</VirtualHost>